!function(){"use strict";function e(e,t){var n=!1;return e.some(function(e){if(e===t)return n=!0,!0}),n}function t(e,t){var n;return e.some(function(e){var l=!0;if(Object.keys(t).forEach(function(n){e[n]!==t[n]&&(l=!1)}),l)return n=e,!0}),n}function n(e,t){var n=-1,l=-1;return e.some(function(e){var o=!0;if(l+=1,Object.keys(t).forEach(function(n){e[n]!==t[n]&&(o=!1)}),o)return n=l,!0}),n}var l=angular.module("angularjs-dropdown-multiselect",[]);l.directive("mfDropdownStaticInclude",["$compile",function(e){return function(t,n,l){var o=l.mfDropdownStaticInclude,s=n.html(o).contents();e(s)(t)}}]),l.directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function(l,o,s,i){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@",currentGroups:"=selectByGroups",disabled:"="},template:function(e,t){var n=!!t.checkboxes,l=!!t.groupBy,o='<div class="multiselect-parent btn-group dropdown-multiselect">';o+='<button ng-disabled="disabled" type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}&nbsp;<span class="caret"></span></button>',o+="<div class=\"dropdown-menu\" scrollbar ng-if=\"open\" ng-style=\"{display: open ? 'block' : 'none', height: 'auto', maxHeight: settings.scrollableHeight, overflow: 'hidden', padding: '0px' }\" >",o+="<ul class=\"dropdown-list\" ng-style=\"{ padding: '10px', margin: '0px' }\" >",o+='<li ng-if="settings.showCheckAll && settings.selectionLimit !== 1"><a ng-keydown="keyDownLink($event)" data-ng-click="selectAll()" tabindex="-1" id="selectAll"><span class="glyphicon glyphicon-ok"></span>  {{texts.checkAll}}</a>',o+='<li ng-if="settings.showUncheckAll"><a ng-keydown="keyDownLink($event)" data-ng-click="deselectAll();" tabindex="-1" id="deselectAll"><span class="glyphicon glyphicon-remove"></span>   {{texts.uncheckAll}}</a></li>',o+='<li ng-if="currentGroups && ((settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll)" class="divider"></li>',o+='<li ng-repeat="currentGroup in currentGroups track by $index"><a ng-bind="::currentGroup.title" ng-click="selectCurrentGroup(currentGroup)" ng-class="{\'dropdown-selected-group\': selectedGroup == currentGroup.value}" tabindex="-1"></a></li>',o+='<li ng-if="settings.showEnableSearchButton && settings.enableSearch"><a ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.disableSearch}}</a></li>',o+='<li ng-if="settings.showEnableSearchButton && !settings.enableSearch"><a ng-keydown="keyDownLink($event); keyDownToggleSearch();" ng-click="toggleSearch($event);" tabindex="-1">{{texts.enableSearch}}</a></li>',o+='<li ng-if="(settings.showCheckAll && settings.selectionLimit > 0) || settings.showUncheckAll || settings.showEnableSearchButton || currentGroups" class="divider"></li>',o+='<li ng-if="settings.enableSearch"><div class="dropdown-header"><input type="text" class="form-control searchField" ng-keydown="keyDownSearchDefault($event); keyDownSearch($event, input.searchFilter);" ng-style="{width: \'100%\'}" ng-model="input.searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>',o+='<li ng-if="settings.enableSearch" class="divider"></li>',l?(o+='<li ng-repeat-start="option in orderedItems | filter:getFilter(input.searchFilter)" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupTitle(getPropertyForObject(option, settings.groupBy)) }}</li>',o+='<li ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" ng-repeat-end role="presentation">'):o+='<li ng-class="{\'active\': isChecked(getPropertyForObject(option,settings.idProp)) && settings.styleActive}" role="presentation" ng-repeat="option in options | filter:getFilter(input.searchFilter)">',o+='<a ng-keydown="option.disabled || keyDownLink($event)" role="menuitem" class="option" tabindex="-1" ng-click="option.disabled || setSelectedItem(getPropertyForObject(option,settings.idProp), false, true)" ng-disabled="option.disabled">',o+=n?'<div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> <span mf-dropdown-static-include="{{settings.template}}"></div></label></span></a>':'<span data-ng-class="{\'glyphicon glyphicon-ok\': isChecked(getPropertyForObject(option,settings.idProp))}"> </span> <span mf-dropdown-static-include="{{settings.template}}"></span></a>',o+="</li>",o+='<li class="divider" ng-show="settings.selectionLimit > 1"></li>',o+='<li role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>',o+="</ul>",o+="</div>",o+="</div>",e.html(o)},link:function(s,i,r){function c(e){var t={};return""===s.settings.externalIdProp?t[s.settings.idProp]=e:t[s.settings.externalIdProp]=e,t}function a(e){for(var t in e)delete e[t]}var d=i.children()[0];s.toggleDropdown=function(){s.open=!s.open,s.settings.keyboardControls&&s.open&&(1===s.settings.selectionLimit&&s.settings.enableSearch?setTimeout(function(){angular.element(i)[0].querySelector(".searchField").focus()},0):setTimeout(function(){angular.element(i)[0].querySelector(".option").focus()},0))},s.checkboxClick=function(e,t){s.setSelectedItem(t,!1,!0),e.stopImmediatePropagation()},s.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop,onSelectionChanged:angular.noop},s.settings={dynamicTitle:!0,scrollableHeight:"300px",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,showEnableSearchButton:!1,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:r.groupBy||void 0,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:angular.noop,styleActive:!1,keyboardControls:!1,template:"{{getPropertyForObject(option, settings.displayProp)}}",searchField:"$"},s.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked",disableSearch:"Disable search",enableSearch:"Enable search"},s.input={searchFilter:s.searchFilter||""},angular.isDefined(s.settings.groupBy)&&s.$watch("options",function(e){angular.isDefined(e)&&(s.orderedItems=l("orderBy")(e,s.settings.groupBy))}),s.$watch("selectedModel",function(e){Array.isArray(e)?s.singleSelection=!1:s.singleSelection=!0}),s.selectCurrentGroup=function(e){if(s.selectedGroup=e.value,s.orderedItems)for(var t=0;t<s.orderedItems.length;t++){var n=s.orderedItems[t],l=s.selectedModel.map(function(e){return e.id}).indexOf(n.id);n[s.groupBy]===e.value?l===-1&&s.selectedModel.push({id:n.id}):l!==-1&&s.selectedModel.splice(l,1)}s.externalEvents.onSelectionChanged()},angular.extend(s.settings,s.extraSettings||[]),angular.extend(s.externalEvents,s.events||[]),angular.extend(s.texts,s.translationTexts),s.singleSelection=1===s.settings.selectionLimit,s.singleSelection&&angular.isArray(s.selectedModel)&&0===s.selectedModel.length&&a(s.selectedModel),s.settings.closeOnBlur&&o.on("click",function(t){if(s.open){for(var n=t.target.parentElement,l=!1;angular.isDefined(n)&&null!==n&&!l;)n.className.split&&e(n.className.split(" "),"multiselect-parent")&&!l&&n===d&&(l=!0),n=n.parentElement;l||s.$apply(function(){s.open=!1})}}),s.getGroupTitle=function(e){return null!==s.settings.groupByTextProvider?s.settings.groupByTextProvider(e):e},s.getButtonText=function(){if(s.settings.dynamicTitle&&(angular.isArray(s.selectedModel)&&s.selectedModel.length>0||angular.isObject(s.selectedModel)&&Object.keys(s.selectedModel).length>0)){if(s.settings.smartButtonMaxItems>0){var e=[];return angular.forEach(s.options,function(t){if(s.isChecked(s.getPropertyForObject(t,s.settings.idProp))){var n=s.getPropertyForObject(t,s.settings.displayProp),l=s.settings.smartButtonTextConverter(n,t);e.push(l?l:n)}}),s.selectedModel.length>s.settings.smartButtonMaxItems&&(e=e.slice(0,s.settings.smartButtonMaxItems),e.push("...")),e.join(", ")}var t;return t=s.singleSelection?null!==s.selectedModel&&angular.isDefined(s.selectedModel[s.settings.idProp])?1:0:angular.isDefined(s.selectedModel)?s.selectedModel.length:0,0===t?s.texts.buttonDefaultText:t+" "+s.texts.dynamicButtonTextSuffix}return s.texts.buttonDefaultText},s.getPropertyForObject=function(e,t){return angular.isDefined(e)&&e.hasOwnProperty(t)?e[t]:""},s.selectAll=function(){var e;s.deselectAll(!0),s.externalEvents.onSelectAll(),e=l("filter")(s.options,s.getFilter(s.input.searchFilter)),angular.forEach(e,function(e){s.setSelectedItem(e[s.settings.idProp],!0,!1)}),s.externalEvents.onSelectionChanged(),s.selectedGroup=null},s.deselectAll=function(e){e=e||!1,e||s.externalEvents.onDeselectAll(),s.singleSelection?a(s.selectedModel):s.selectedModel.splice(0,s.selectedModel.length),e||s.externalEvents.onSelectionChanged(),s.selectedGroup=null},s.setSelectedItem=function(e,l,o){var i=c(e),r=null;if(r=""===s.settings.externalIdProp?t(s.options,i):i,s.singleSelection)a(s.selectedModel),angular.extend(s.selectedModel,r),s.externalEvents.onItemSelect(r),(s.settings.closeOnSelect||s.settings.closeOnDeselect)&&(s.open=!1);else{l=l||!1;var d=n(s.selectedModel,i)!==-1;!l&&d?(s.selectedModel.splice(n(s.selectedModel,i),1),s.externalEvents.onItemDeselect(i),s.settings.closeOnDeselect&&(s.open=!1)):!d&&(0===s.settings.selectionLimit||s.selectedModel.length<s.settings.selectionLimit)&&(s.selectedModel.push(r),s.externalEvents.onItemSelect(r),s.settings.closeOnSelect&&(s.open=!1),s.settings.selectionLimit>0&&s.selectedModel.length===s.settings.selectionLimit&&s.externalEvents.onMaxSelectionReached())}o&&s.externalEvents.onSelectionChanged(),s.selectedGroup=null},s.isChecked=function(e){return s.singleSelection?null!==s.selectedModel&&angular.isDefined(s.selectedModel[s.settings.idProp])&&s.selectedModel[s.settings.idProp]===c(e)[s.settings.idProp]:n(s.selectedModel,c(e))!==-1},s.externalEvents.onInitDone(),s.keyDownLink=function(e){var t,n=angular.element(e.target).scope(),l=e.srcElement.parentNode;if(s.settings.keyboardControls)if(13===e.keyCode||32===e.keyCode)e.preventDefault(),n.option?s.setSelectedItem(s.getPropertyForObject(n.option,s.settings.idProp),!1,!0):"deselectAll"===e.srcElement.id?s.deselectAll():"selectAll"===e.srcElement.id&&s.selectAll();else if(38===e.keyCode){for(e.preventDefault(),l.previousElementSibling&&(t=l.previousElementSibling.querySelector("a")||l.previousElementSibling.querySelector("input"));!t&&l;)l=l.previousElementSibling,l&&(t=l.querySelector("a")||l.querySelector("input"));t&&t.focus()}else if(40===e.keyCode){for(e.preventDefault(),l.nextElementSibling&&(t=l.nextElementSibling.querySelector("a")||l.nextElementSibling.querySelector("input"));!t&&l;)l=l.nextElementSibling,l&&(t=l.querySelector("a")||l.querySelector("input"));t&&t.focus()}else 27===e.keyCode&&(e.preventDefault(),s.toggleDropdown())},s.keyDownSearchDefault=function(e){var t,n=e.srcElement.parentNode.parentNode;if(s.settings.keyboardControls)if(9===e.keyCode||40===e.keyCode)e.preventDefault(),setTimeout(function(){angular.element(i)[0].querySelector(".option").focus()},0);else if(38===e.keyCode){for(e.preventDefault(),n.previousElementSibling&&(t=n.previousElementSibling.querySelector("a")||n.previousElementSibling.querySelector("input"));!t&&n;)n=n.previousElementSibling,n&&(t=n.querySelector("a")||n.querySelector("input"));t&&t.focus()}else 27===e.keyCode&&(e.preventDefault(),s.toggleDropdown())},s.keyDownSearch=function(e,t){var n;s.settings.keyboardControls&&13===e.keyCode&&(1===s.settings.selectionLimit&&s.settings.enableSearch?(n=l("filter")(s.options,s.getFilter(t)),1===n.length&&s.setSelectedItem(s.getPropertyForObject(n[0],s.settings.idProp),!1,!0)):s.settings.enableSearch&&s.selectAll())},s.getFilter=function(e){var t={};return t[s.settings.searchField]=e,t},s.toggleSearch=function(e){e&&e.stopPropagation(),s.settings.enableSearch=!s.settings.enableSearch,s.settings.enableSearch||(s.input.searchFilter="")},s.keyDownToggleSearch=function(){s.settings.keyboardControls&&13===event.keyCode&&(s.toggleSearch(),s.settings.enableSearch?setTimeout(function(){angular.element(i)[0].querySelector(".searchField").focus()},0):angular.element(i)[0].querySelector(".option").focus())}}}}])}();